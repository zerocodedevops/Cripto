datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  name      String?
  phone     String?
  role      String    @default("CLIENT") // Enum removed
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  bookings  Booking[]
}

model Service {
  id          String   @id @default(uuid())
  name        String
  description String?
  duration    Int
  price       Float    // Decimal removed
  category    String
  active      Boolean  @default(true)

  bookings    Booking[]
  staff       Staff[]  @relation("StaffServices")
}

model Staff {
  id          String   @id @default(uuid())
  name        String
  bio         String?
  email       String   @unique
  active      Boolean  @default(true)

  services    Service[] @relation("StaffServices")
  schedules   Availability[]
  bookings    Booking[]
}

model Availability {
  id          String   @id @default(uuid())
  staffId     String
  staff       Staff    @relation(fields: [staffId], references: [id])
  dayOfWeek   Int      // 0 = Sunday
  startTime   String   // "09:00"
  endTime     String   // "18:00"
  breaks      String?  // JSON stringified

  @@unique([staffId, dayOfWeek])
}

model Booking {
  id              String        @id @default(uuid())
  userId          String
  user            User          @relation(fields: [userId], references: [id])
  serviceId       String
  service         Service       @relation(fields: [serviceId], references: [id])
  staffId         String
  staff           Staff         @relation(fields: [staffId], references: [id])

  date            DateTime
  endTime         DateTime

  status          String        @default("PENDING") // Enum removed
  paymentIntentId String?
  totalPrice      Float         // Decimal removed

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([date, staffId])
}
